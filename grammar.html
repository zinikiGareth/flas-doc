<html>
<head>
<title>FLAS Grammar</title>
<link type='text/css' rel='stylesheet' href='grammar.css'>
</head>
<body>
<h1>FLAS Grammar</h1>

    <p>FLAS is an actor-based functional language for cards.</p>
  
    <h2>Lexical Issues</h2>
  <h3>ACOR</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>acor</span><div class='lexical-description'>
  	<p>The <tt>acor</tt> keyword introduces an object accessor function.</p>
  </div><h3>AGENT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>agent</span><div class='lexical-description'>
  	<p>The <tt>agent</tt> keyword introduces an agent declaration.</p>
  </div><h3>APPLY</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\.</span><div class='lexical-description'>
  	<p>The apply operator.</p>
  </div><h3>ASSERT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>assert</span><div class='lexical-description'>
  	<p>The <tt>assert</tt> keyword introduces an assert step in a unit test.</p>
  </div><h3>BINOP</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[-+*/.]</span><div class='lexical-description'>
  	<p>One of the standard binary operators.  They have precedence, but this is not apparent from the grammar.</p>
  	<p class="comment">We should specify the precedence here.</p>
  </div><h3>CARD</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>card</span><div class='lexical-description'>
  	<p>The <tt>card</tt> keyword introduces a card definition.</p>
  </div><h3>CCB</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\}</span><div class='lexical-description'>
  	<p>A closing curly bracket delimits the end of a constructor pattern or object creation.</p>
  </div><h3>COLON</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>:</span><div class='lexical-description'>
  	<p>Can be an operator or can be used to define object literals.</p>
  </div><h3>COMMA</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>,</span><div class='lexical-description'>
  	<p>Separates similar items in a list.</p>
  </div><h3>CONTRACT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>contract</span><div class='lexical-description'>
  	<p>The <tt>contract</tt> keyword introduces a contract declaration.</p>
  	<p>It is also used in unit tests to invoke a contract method on a card or service.</p>
  </div><h3>CRB</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\)</span><div class='lexical-description'>
  	<p>A closing round bracket delimits the end of an expression or pattern.</p>
  </div><h3>CSB</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\]</span><div class='lexical-description'>
  	<p>A closing square bracket delimits the end of a list operation or polymorphic variable list.</p>
  </div><h3>CTOR</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>ctor</span><div class='lexical-description'>
  	<p>The <tt>ctor</tt> keyword introduces an object constructor declaration.</p>
  </div><h3>DATA</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>data</span><div class='lexical-description'>
  	<p>The <tt>data</tt> keyword introduces a data declaration in a unit test.</p>
  </div><h3>DEAL</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>deal</span><div class='lexical-description'>
  	<p>The <tt>deal</tt> keyword introduces a deal declaration.</p>
  </div><h3>DOCWORD</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[a-zA-Z_0-9]+</span><div class='lexical-description'>
    <p>Words that can appear in the documentation of a test case.</p>
  </div><h3>ENTITY</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>entity</span><div class='lexical-description'>
  	<p>The <tt>entity</tt> keyword introduces an entity definition.</p>
  </div><h3>ENVELOPE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>envelope</span><div class='lexical-description'>
  	<p>The <tt>envelope</tt> keyword introduces an envelope definition.</p>
  </div><h3>EOL</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\n</span><div class='lexical-description'>
  	<p>Specifies the end of a line.</p>
  </div><h3>EQ</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>=</span><div class='lexical-description'>
  	<p>Defines the variable/function definition operator.</p>
  </div><h3>EVENT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>event</span><div class='lexical-description'>
  	<p>The <tt>event</tt> keyword introduces an event handler.</p>
  </div><h3>EXPECT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>expect</span><div class='lexical-description'>
  	<p>The <tt>expect</tt> keyword introduces a mock expectation.</p>
  </div><h3>FALSE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>False</span><div class='lexical-description'>
  	<p>The boolean literal <tt>False</tt>.</p>
  </div><h3>GUARD</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\|</span><div class='lexical-description'>
  	<p>Defines the variable/function definition operator.</p>
  </div><h3>HANDLE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>-&gt;</span><div class='lexical-description'>
  	<p>The HANDLE operator is used to assign subscription handles to handle variables.</p>
  </div><h3>HANDLER</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>handler</span><div class='lexical-description'>
  	<p>The <tt>handler</tt> keyword introduces a callback handler.</p>
  </div><h3>IMPLEMENTS</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>implements</span><div class='lexical-description'>
  	<p>The <tt>implements</tt> keyword introduces a contract implementation in a card.</p>
  </div><h3>INVOKE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>invoke</span><div class='lexical-description'>
  	<p>The <tt>invoke</tt> keyword is used in unit tests to invoke a method on an object.</p>
  </div><h3>MATCH</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>match</span><div class='lexical-description'>
  	<p>The <tt>match</tt> keyword introduces a template matching step in a unit test.</p>
  </div><h3>METHOD</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>method</span><div class='lexical-description'>
  	<p>The <tt>method</tt> keyword introduces a standalone method definition.</p>
  </div><h3>NUMBER</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[0-9.e+-]+</span><div class='lexical-description'>
  	<p>A numeric literal.</p>
  </div><h3>OBJECT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>object</span><div class='lexical-description'>
  	<p>The <tt>object</tt> keyword introduces an object declaration.</p>
  </div><h3>OCB</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\{</span><div class='lexical-description'>
  	<p>An opening curly bracket introduces a constructor pattern match or object creation.</p>
  </div><h3>OFFER</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>offer</span><div class='lexical-description'>
  	<p>The <tt>offer</tt> keyword introduces an offer declaration.</p>
  </div><h3>OPTIONAL</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>optional</span><div class='lexical-description'>
  	<p>The <tt>optional</tt> keyword indicates that a contract method does not need to be implemented.</p>
  </div><h3>ORB</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\(</span><div class='lexical-description'>
  	<p>An opening square bracket introduces a sub-element of an expression or pattern.</p>
  </div><h3>OSB</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>\[</span><div class='lexical-description'>
  	<p>An opening square bracket introduces various list operations as well as polymorphic variables.</p>
  </div><h3>PROVIDES</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>provides</span><div class='lexical-description'>
  	<p>The <tt>provides</tt> keyword introduces a block indicating that the service portion of a contract will be provided.</p>
  </div><h3>REQUIRES</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>requires</span><div class='lexical-description'>
  	<p>The <tt>requires</tt> keyword identifies a variable which is bound to a service of the specified contract.</p>
  </div><h3>SEND</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>&lt;-</span><div class='lexical-description'>
  	<p>Method actions, variable assignments and template definitions are defined using the SEND operator.</p>
  </div><h3>SENDTO</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>=&gt;</span><div class='lexical-description'>
  	<p>The SENDTO operator is used to pass things around in templates.</p>
  </div><h3>SERVICE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>service</span><div class='lexical-description'>
  	<p>The <tt>service</tt> keyword introduces a service declaration.</p>
  </div><h3>SHOVE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>shove</span><div class='lexical-description'>
  	<p>The <tt>shove</tt> keyword is used in unit tests to directly affect object or card state.</p>
  </div><h3>STATE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>state</span><div class='lexical-description'>
  	<p>The <tt>state</tt> keyword introduces a card or object state.</p>
  </div><h3>STRING</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>&quot;[^&quot;]*&quot;|'[^']*'</span><div class='lexical-description'>
  	<p>A string literal.</p>
  </div><h3>STRUCT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>struct</span><div class='lexical-description'>
  	<p>The <tt>struct</tt> keyword introduces a struct declaration.</p>
  </div><h3>STYLE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>style</span><div class='lexical-description'>
  	<p>The <tt>style</tt> keyword is used to match card styles.</p>
  </div><h3>TEMPLATE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>template</span><div class='lexical-description'>
  	<p>The <tt>template</tt> keyword introduces a template definition.</p>
  </div><h3>TEST</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>test</span><div class='lexical-description'>
  	<p>The <tt>test</tt> keyword introduces a unit test case.</p>
  </div><h3>TEXT</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>text</span><div class='lexical-description'>
  	<p>The <tt>text</tt> keyword is used to match text on a card.</p>
  </div><h3>TRUE</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>True</span><div class='lexical-description'>
  	<p>The boolean literal <tt>True</tt>.</p>
  </div><h3>UNION</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>union</span><div class='lexical-description'>
  	<p>The <tt>union</tt> keyword introduces a union declaration.</p>
  </div><h3>UNOP</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[\-]</span><div class='lexical-description'>
  	<p>One of the standard unary operators.  They have precedence, but this is not apparent from the grammar.</p>
  	<p class="comment">We should specify the precedence here.</p>
  </div><h3>WRAPS</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>wraps</span><div class='lexical-description'>
  	<p>The <tt>wraps</tt> keyword introduces a definition that wraps an entity in an envelope.</p>
  </div><h3>event-name</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[a-z][a-z0-9-]*</span><div class='lexical-description'>
  	<p>The mnemonic name of an event, such as 'click' or 'scroll-down'.</p>
  </div><h3>poly-var</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[A-Z][A-Z]?</span><div class='lexical-description'>
  	<p>Polymorphic variable names must be one or two capital letters.</p>
  </div><h3>template-name</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[a-z][a-z0-9-]*</span><div class='lexical-description'>
  	<p>The name of a template or template item, which must match the name of a provided webzip element.</p>
  </div><h3>type-name</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[A-Z][A-Za-z0-9_][A-Za-z0-9_]+</span><div class='lexical-description'>
  	<p>Concrete type names must start with a capital letter and have at
  	least three characters in the name.</p>
  </div><h3>var-name</h3><span class='pattern-title'>Pattern:</span><span class='pattern'>[a-z][A-Za-z0-9_]*</span><div class='lexical-description'>
  	<p>Function and variable names are one or more characters, where
  	the first character must be a lower case alphabetic character.</p>
  </div><h2>Summary</h2>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(1)</div>
  <div class='production-name'>file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;source-file&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-file&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;protocol-test-file&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;system-test-file&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(2)</div>
  <div class='production-name'>source-file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;top-level-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(3)</div>
  <div class='production-name'>unit-test-file</div>
  <div class='production-op'>::=</div>
&nbsp;<span class='production-reference'>&lt;unit-test-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(4)</div>
  <div class='production-name'>protocol-test-file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;protocol-test-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(5)</div>
  <div class='production-name'>system-test-file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;system-test-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(6)</div>
  <div class='production-name'>top-level-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;top-level-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;function-scope-unit&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(7)</div>
  <div class='production-name'>top-level-definition</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;struct-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;union-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;entity-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;deal-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;offer-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;envelope-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;wraps-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;contract-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;service-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;agent-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;card-declaration&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(8)</div>
  <div class='production-name'>function-scope</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;function-scope-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(9)</div>
  <div class='production-name'>function-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;tuple-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;standalone-method-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;handler-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(10)</div>
  <div class='production-name'>struct-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>STRUCT</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(11)</div>
  <div class='production-name'>entity-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ENTITY</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(12)</div>
  <div class='production-name'>deal-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>DEAL</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(13)</div>
  <div class='production-name'>offer-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OFFER</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(14)</div>
  <div class='production-name'>struct-field-decl</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;struct-initializer&gt;</span><span class='production-optional'>?</span></div>
<div class='production-block'>
  <div class='production-number'>(15)</div>
  <div class='production-name'>struct-initializer</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(16)</div>
  <div class='production-name'>union-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>UNION</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;&gt;</span><span class='production-reference'>&lt;type-reference&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(17)</div>
  <div class='production-name'>envelope-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ENVELOPE</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;envelope-field-list&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(18)</div>
  <div class='production-name'>envelope-field-list</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;envelope-field-decl&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(19)</div>
  <div class='production-name'>envelope-field-decl</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(20)</div>
  <div class='production-name'>wraps-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>WRAPS</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;wraps-binding-list&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(21)</div>
  <div class='production-name'>wraps-binding-list</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;wraps-binding-decl&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(22)</div>
  <div class='production-name'>wraps-binding-decl</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;struct-initializer&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(23)</div>
  <div class='production-name'>contract-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;contract-intro&gt;</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;contract-method-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(24)</div>
  <div class='production-name'>contract-intro</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CONTRACT</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>CONTRACT</span>&nbsp;<span class='production-token'>SERVICE</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>CONTRACT</span>&nbsp;<span class='production-token'>HANDLER</span></div>
<div class='production-block'>
  <div class='production-number'>(25)</div>
  <div class='production-name'>contract-method-decl</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OPTIONAL</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-typed&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-reference'>&lt;handled-by&gt;</span><span class='production-optional'>?</span>&nbsp;</div>
<div class='production-block'>
  <div class='production-number'>(26)</div>
  <div class='production-name'>handled-by</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLE</span>&nbsp;<span class='production-reference'>&lt;argument-pattern-typed&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(27)</div>
  <div class='production-name'>function-case-definition</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;simple-function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;degenerate-guarded-function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;guarded-function-case-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(28)</div>
  <div class='production-name'>simple-function-case-definition</div>
  <div class='production-op'>::=</div>
&nbsp;<span class='production-token'>var-name</span>&nbsp;&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(29)</div>
  <div class='production-name'>degenerate-guarded-function-case-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;guarded-default-expression&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(30)</div>
  <div class='production-name'>guarded-function-case-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;guarded-equations&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(31)</div>
  <div class='production-name'>guarded-equations</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;guarded-expression&gt;</span><span class='production-many'>+</span>&nbsp;<span class='production-reference'>&lt;guarded-default-expression&gt;</span><span class='production-optional'>?</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(32)</div>
  <div class='production-name'>guarded-expression</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(33)</div>
  <div class='production-name'>guarded-default-expression</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(34)</div>
  <div class='production-name'>tuple-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;comma-var-name&gt;</span><span class='production-many'>+</span>&nbsp;<span class='production-token'>CRB</span>&nbsp;<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(35)</div>
  <div class='production-name'>comma-var-name</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(36)</div>
  <div class='production-name'>argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;argument-pattern-variable&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-list&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-typed&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-ctor&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(37)</div>
  <div class='production-name'>argument-pattern-maybe-typed</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;argument-pattern-variable&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-typed&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(38)</div>
  <div class='production-name'>argument-pattern-variable</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(39)</div>
  <div class='production-name'>argument-pattern-list</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-block'>
  <div class='production-number'>(40)</div>
  <div class='production-name'>comma-argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(41)</div>
  <div class='production-name'>argument-pattern-typed</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(42)</div>
  <div class='production-name'>argument-pattern-ctor</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>OCB</span>&nbsp;<span class='production-token'>CCB</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>OCB</span>&nbsp;<span class='production-reference'>&lt;field-argument-pattern&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-field-argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CCB</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(43)</div>
  <div class='production-name'>field-argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>COLON</span>&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(44)</div>
  <div class='production-name'>comma-field-argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;field-argument-pattern&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(45)</div>
  <div class='production-name'>type-reference</div>
  <div class='production-op'>::=</div>
<span class='production-token'>type-name</span>&nbsp;<span class='production-reference'>&lt;poly-type-list&gt;</span><span class='production-optional'>?</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>poly-var</span></div>
<div class='production-block'>
  <div class='production-number'>(46)</div>
  <div class='production-name'>poly-type-list</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-type-reference&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-block'>
  <div class='production-number'>(47)</div>
  <div class='production-name'>comma-type-reference</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(48)</div>
  <div class='production-name'>expression</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;literal&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>UNOP</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>BINOP</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>COLON</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(49)</div>
  <div class='production-name'>literal</div>
  <div class='production-op'>::=</div>
<span class='production-token'>NUMBER</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>STRING</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>TRUE</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>FALSE</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;list-literal&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-literal&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(50)</div>
  <div class='production-name'>list-literal</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-expression&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-block'>
  <div class='production-number'>(51)</div>
  <div class='production-name'>comma-expression</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(52)</div>
  <div class='production-name'>object-literal</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OCB</span>&nbsp;<span class='production-token'>CCB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>OCB</span>&nbsp;<span class='production-reference'>&lt;object-member&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-object-member&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CCB</span></div>
<div class='production-block'>
  <div class='production-number'>(53)</div>
  <div class='production-name'>object-member</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;object-key&gt;</span>&nbsp;<span class='production-token'>COLON</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(54)</div>
  <div class='production-name'>object-key</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>STRING</span></div>
<div class='production-block'>
  <div class='production-number'>(55)</div>
  <div class='production-name'>comma-object-member</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;object-member&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(56)</div>
  <div class='production-name'>handler-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLER</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-maybe-typed&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;implementation-method&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(57)</div>
  <div class='production-name'>standalone-method-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>METHOD</span>&nbsp;&nbsp;<span class='production-reference'>&lt;method-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(58)</div>
  <div class='production-name'>object-method-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>METHOD</span>&nbsp;&nbsp;<span class='production-reference'>&lt;method-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(59)</div>
  <div class='production-name'>method-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;method-guards-or-actions&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(60)</div>
  <div class='production-name'>method-guards-or-actions</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;method-guards&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;method-actions&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(61)</div>
  <div class='production-name'>method-guards</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;method-guard&gt;</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(62)</div>
  <div class='production-name'>method-guard</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;method-action&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(63)</div>
  <div class='production-name'>method-actions</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;method-action&gt;</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(64)</div>
  <div class='production-name'>method-action</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;message-method-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;assign-method-action&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(65)</div>
  <div class='production-name'>message-method-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;service-method&gt;</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-reference'>&lt;maybe-handled&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(66)</div>
  <div class='production-name'>service-method</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>APPLY</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(67)</div>
  <div class='production-name'>maybe-handled</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLE</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(68)</div>
  <div class='production-name'>assign-method-action</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;member-path&gt;</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(69)</div>
  <div class='production-name'>member-path</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;member-path-apply&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(70)</div>
  <div class='production-name'>member-path-apply</div>
  <div class='production-op'>::=</div>
<span class='production-token'>APPLY</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(71)</div>
  <div class='production-name'>object-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OBJECT</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;object-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(72)</div>
  <div class='production-name'>object-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;state-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-ctor-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;named-template-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-acor-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-method-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;handler-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(73)</div>
  <div class='production-name'>state-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>STATE</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(74)</div>
  <div class='production-name'>object-ctor-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CTOR</span>&nbsp;&nbsp;<span class='production-reference'>&lt;method-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(75)</div>
  <div class='production-name'>object-acor-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ACOR</span>&nbsp;<span class='production-reference'>&lt;function-case-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(76)</div>
  <div class='production-name'>service-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SERVICE</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;service-contents&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(77)</div>
  <div class='production-name'>service-contents</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;service-scope&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(78)</div>
  <div class='production-name'>service-scope</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;service-scope-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(79)</div>
  <div class='production-name'>service-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;provides-contract&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;function-scope-unit&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(80)</div>
  <div class='production-name'>provides-contract</div>
  <div class='production-op'>::=</div>
<span class='production-token'>PROVIDES</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;implementation-method&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(81)</div>
  <div class='production-name'>agent-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>AGENT</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;agent-contents&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(82)</div>
  <div class='production-name'>agent-contents</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;state-declaration&gt;</span>&nbsp;<span class='production-reference'>&lt;service-scope&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(83)</div>
  <div class='production-name'>card-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CARD</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;card-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(84)</div>
  <div class='production-name'>card-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;state-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;named-template-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;event-handler&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;requires-contract&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;implements-contract&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;service-scope-unit&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(85)</div>
  <div class='production-name'>requires-contract</div>
  <div class='production-op'>::=</div>
<span class='production-token'>REQUIRES</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(86)</div>
  <div class='production-name'>implements-contract</div>
  <div class='production-op'>::=</div>
<span class='production-token'>IMPLEMENTS</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;implementation-method&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(87)</div>
  <div class='production-name'>implementation-method</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-variable&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-reference'>&lt;implementation-result&gt;</span><span class='production-optional'>?</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;method-actions&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(88)</div>
  <div class='production-name'>implementation-result</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLE</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(89)</div>
  <div class='production-name'>event-handler</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EVENT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-typed&gt;</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;method-guards-or-actions&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(90)</div>
  <div class='production-name'>named-template-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>TEMPLATE</span>&nbsp;<span class='production-token'>template-name</span>&nbsp;<span class='production-reference'>&lt;define-template-chain&gt;</span><span class='production-optional'>?</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-bind&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(91)</div>
  <div class='production-name'>define-template-chain</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;template-chain-var&gt;</span><span class='production-many'>+</span></div>
<div class='production-block'>
  <div class='production-number'>(92)</div>
  <div class='production-name'>template-chain-var</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(93)</div>
  <div class='production-name'>template-bind</div>
  <div class='production-op'>::=</div>
<span class='production-token'>template-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;pass-to-template&gt;</span><span class='production-optional'>?</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>template-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;option-template-binds&gt;</span></div></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>template-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(94)</div>
  <div class='production-name'>option-template-binds</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;option-template-bind&gt;</span><span class='production-many'>+</span>&nbsp;<span class='production-reference'>&lt;default-option-template-bind&gt;</span><span class='production-optional'>?</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;default-option-template-bind&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(95)</div>
  <div class='production-name'>option-template-bind</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;pass-to-template&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(96)</div>
  <div class='production-name'>default-option-template-bind</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;pass-to-template&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(97)</div>
  <div class='production-name'>pass-to-template</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SENDTO</span>&nbsp;<span class='production-token'>template-name</span></div>
<div class='production-block'>
  <div class='production-number'>(98)</div>
  <div class='production-name'>template-customization</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;template-style&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;template-event&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(99)</div>
  <div class='production-name'>template-style</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>SENDTO</span>&nbsp;<span class='production-token'>STRING</span><span class='production-many'>+</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(100)</div>
  <div class='production-name'>template-event</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SENDTO</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(101)</div>
  <div class='production-name'>unit-test-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;unit-test-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-data-declaration&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(102)</div>
  <div class='production-name'>unit-test-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>TEST</span>&nbsp;<span class='production-token'>DOCWORD</span><span class='production-many'>+</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;unit-test-step&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(103)</div>
  <div class='production-name'>unit-test-step</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;unit-data-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-event-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-invoke-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-contract-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-assert&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-shove&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-expect&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-match&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(104)</div>
  <div class='production-name'>unit-event-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EVENT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>template-name</span>&nbsp;<span class='production-token'>event-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(105)</div>
  <div class='production-name'>unit-invoke-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>INVOKE</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(106)</div>
  <div class='production-name'>unit-contract-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CONTRACT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(107)</div>
  <div class='production-name'>unit-test-assert</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ASSERT</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;expression&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(108)</div>
  <div class='production-name'>unit-test-shove</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SHOVE</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>APPLY</span>&nbsp;<span class='production-reference'>&lt;member-path&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;expression&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(109)</div>
  <div class='production-name'>unit-test-expect</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EXPECT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(110)</div>
  <div class='production-name'>unit-test-match</div>
  <div class='production-op'>::=</div>
<span class='production-token'>MATCH</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;unit-test-match-category&gt;</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(111)</div>
  <div class='production-name'>unit-test-match-category</div>
  <div class='production-op'>::=</div>
<span class='production-token'>TEXT</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>STYLE</span></div>
<div class='production-block'>
  <div class='production-number'>(112)</div>
  <div class='production-name'>unit-data-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;unit-expr-data-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-fields-data-declaration&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(113)</div>
  <div class='production-name'>unit-expr-data-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>DATA</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(114)</div>
  <div class='production-name'>unit-fields-data-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>DATA</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;&gt;</span><span class='production-reference'>&lt;unit-fields-data-initializer&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(115)</div>
  <div class='production-name'>unit-fields-data-initializer</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(116)</div>
  <div class='production-name'>protocol-test-unit</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(117)</div>
  <div class='production-name'>system-test-unit</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span></div>
<h2>Definitions</h2>
<h3>Files</h3>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(1)</div>
  <div class='production-name'>file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;source-file&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-file&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;protocol-test-file&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;system-test-file&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(2)</div>
  <div class='production-name'>source-file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;top-level-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(3)</div>
  <div class='production-name'>unit-test-file</div>
  <div class='production-op'>::=</div>
&nbsp;<span class='production-reference'>&lt;unit-test-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(4)</div>
  <div class='production-name'>protocol-test-file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;protocol-test-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(5)</div>
  <div class='production-name'>system-test-file</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;system-test-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(6)</div>
  <div class='production-name'>top-level-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;top-level-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;function-scope-unit&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(7)</div>
  <div class='production-name'>top-level-definition</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;struct-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;union-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;entity-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;deal-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;offer-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;envelope-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;wraps-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;contract-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;service-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;agent-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;card-declaration&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(8)</div>
  <div class='production-name'>function-scope</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;function-scope-unit&gt;</span><span class='production-many'>*</span></div>
<div class='section-description'>

	    <p>FLAS units are grouped into files.  There are no specific rules about how units are grouped and grouping units together in a file offers no special privileges of access.</p>
        <p>This is the set of units that can be defined at the top level in files.  Since many of these may also be defined within nested function scopes, this is defined as a production of those together with the others that cannot.</p>
        <p>These units can only be declared at the top level in a file.</p>
        <p>Clearly the test ones are not correct yet :-)</p>
	  </div>
<h3>Scoping</h3>
<div class='production-block'>
  <div class='production-number'>(9)</div>
  <div class='production-name'>function-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;tuple-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;standalone-method-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;handler-definition&gt;</span></div>
<div class='section-description'>

	       This set of units can be defined at the top level in files or within the
	       scope of a function.
	    </div>
<h3>Data Declarations</h3>
<div class='production-block'>
  <div class='production-number'>(10)</div>
  <div class='production-name'>struct-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>STRUCT</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(11)</div>
  <div class='production-name'>entity-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ENTITY</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(12)</div>
  <div class='production-name'>deal-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>DEAL</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(13)</div>
  <div class='production-name'>offer-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OFFER</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(14)</div>
  <div class='production-name'>struct-field-decl</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;struct-initializer&gt;</span><span class='production-optional'>?</span></div>
<div class='production-block'>
  <div class='production-number'>(15)</div>
  <div class='production-name'>struct-initializer</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(16)</div>
  <div class='production-name'>union-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>UNION</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;&gt;</span><span class='production-reference'>&lt;type-reference&gt;</span></div></div>
<div class='section-description'>

	    </div>
<h3>Envelopes</h3>
<div class='production-block'>
  <div class='production-number'>(17)</div>
  <div class='production-name'>envelope-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ENVELOPE</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>poly-var</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;envelope-field-list&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(18)</div>
  <div class='production-name'>envelope-field-list</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;envelope-field-decl&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(19)</div>
  <div class='production-name'>envelope-field-decl</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(20)</div>
  <div class='production-name'>wraps-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>WRAPS</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;wraps-binding-list&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(21)</div>
  <div class='production-name'>wraps-binding-list</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;wraps-binding-decl&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(22)</div>
  <div class='production-name'>wraps-binding-decl</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;struct-initializer&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='section-description'>

    	    <p>Envelopes are used to provide consistent access to a range of entities.  In this way, they can be considered similar to <tt>union</tt> objects or <tt>typeclasses</tt> in Haskell.</p>
    	    <p>An envelope is defined in the same way as an entity, and all <i>instances</i> of an envelope must be <tt>entity</tt> declarations.</p>
    	    <p>The <tt>wraps</tt> definition specifies that an <tt>envelope</tt> can be represented by a specific <tt>entity</tt>.  This is then implemented by identifying how each variable in the envelope is made available from expressions which are phrased in terms of the members of the entity.</p>
    	    <p>This mapping is strictly one way.  It is not possible to <i>assign</i> to fields of an envelope.</p>
    	    <p>For more details, see <a href="index.html#envelopes">envelopes</a>.</p>
    	  </div>
<h3>Contracts</h3>
<div class='production-block'>
  <div class='production-number'>(23)</div>
  <div class='production-name'>contract-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;contract-intro&gt;</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;contract-method-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(24)</div>
  <div class='production-name'>contract-intro</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CONTRACT</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>CONTRACT</span>&nbsp;<span class='production-token'>SERVICE</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>CONTRACT</span>&nbsp;<span class='production-token'>HANDLER</span></div>
<div class='production-block'>
  <div class='production-number'>(25)</div>
  <div class='production-name'>contract-method-decl</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OPTIONAL</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-typed&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-reference'>&lt;handled-by&gt;</span><span class='production-optional'>?</span>&nbsp;</div>
<div class='production-block'>
  <div class='production-number'>(26)</div>
  <div class='production-name'>handled-by</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLE</span>&nbsp;<span class='production-reference'>&lt;argument-pattern-typed&gt;</span></div>
<div class='section-description'>

        Contracts are core to FLAS.
        A contract defines an abstraction of what a card, agent or service does in a way that should be independently testable with tests written against the abstraction.
        <p>
        There are three types of contracts:
        </p>
        <ul>
        <li>those that are implemented by cards and agents and can be called by the container;</li>
        <li>those provided by a service or a providing agent and can be required by cards and then called;</li>
        <li>those defining how handlers will operate.</li>
        </ul>
        In each case, the contract specifies a set of methods which must all be implemented together by the implementing card, agent, service or handler.
        <p>
        Each method must have a method name.  It may optionally be marked as <code>optional</code>, meaning that implementers do not need to provide a definition for it.
        It specifies zero or more arguments; these must be typed, and there are restrictions on the types that may be passed.
        It may optionally specify a subscription handler.  This must be a typed variable where the type is a hander contract.
        </p>
      </div>
<h3>Functions</h3>
<div class='production-block'>
  <div class='production-number'>(27)</div>
  <div class='production-name'>function-case-definition</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;simple-function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;degenerate-guarded-function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;guarded-function-case-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(28)</div>
  <div class='production-name'>simple-function-case-definition</div>
  <div class='production-op'>::=</div>
&nbsp;<span class='production-token'>var-name</span>&nbsp;&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(29)</div>
  <div class='production-name'>degenerate-guarded-function-case-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;guarded-default-expression&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(30)</div>
  <div class='production-name'>guarded-function-case-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;guarded-equations&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(31)</div>
  <div class='production-name'>guarded-equations</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;guarded-expression&gt;</span><span class='production-many'>+</span>&nbsp;<span class='production-reference'>&lt;guarded-default-expression&gt;</span><span class='production-optional'>?</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(32)</div>
  <div class='production-name'>guarded-expression</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(33)</div>
  <div class='production-name'>guarded-default-expression</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(34)</div>
  <div class='production-name'>tuple-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;comma-var-name&gt;</span><span class='production-many'>+</span>&nbsp;<span class='production-token'>CRB</span>&nbsp;<span class='production-token'>EQ</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(35)</div>
  <div class='production-name'>comma-var-name</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='section-description'>

	       Constants and functions can be declared either at the top level or within nested scopes.
	       When declared within a nested scope, all the surrounding variables and definitions are available
	       for reference by name.
	       Note that a complete function declaration is made up of multiple cases applying to specific patterns.
	       All of the cases must be declared ``together'' without any intervening blocks, but this is not
	       included in this grammar specification.
	       There are two ways to declare a function case.
	       It is possible to declare a single expression on the same line as the function declaration.
	       Or the function name and argument patterns can appear on one line, and one or more guarded equations
	       can appear on subsequent lines.
	    </div>
<h3>Patterns</h3>
<div class='production-block'>
  <div class='production-number'>(36)</div>
  <div class='production-name'>argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;argument-pattern-variable&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-list&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-typed&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-ctor&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(37)</div>
  <div class='production-name'>argument-pattern-maybe-typed</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;argument-pattern-variable&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;argument-pattern-typed&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(38)</div>
  <div class='production-name'>argument-pattern-variable</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(39)</div>
  <div class='production-name'>argument-pattern-list</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-block'>
  <div class='production-number'>(40)</div>
  <div class='production-name'>comma-argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(41)</div>
  <div class='production-name'>argument-pattern-typed</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(42)</div>
  <div class='production-name'>argument-pattern-ctor</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>OCB</span>&nbsp;<span class='production-token'>CCB</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>OCB</span>&nbsp;<span class='production-reference'>&lt;field-argument-pattern&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-field-argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CCB</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(43)</div>
  <div class='production-name'>field-argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>COLON</span>&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(44)</div>
  <div class='production-name'>comma-field-argument-pattern</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;field-argument-pattern&gt;</span></div>
<div class='section-description'>

    	  </div>
<h3>Types</h3>
<div class='production-block'>
  <div class='production-number'>(45)</div>
  <div class='production-name'>type-reference</div>
  <div class='production-op'>::=</div>
<span class='production-token'>type-name</span>&nbsp;<span class='production-reference'>&lt;poly-type-list&gt;</span><span class='production-optional'>?</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>poly-var</span></div>
<div class='production-block'>
  <div class='production-number'>(46)</div>
  <div class='production-name'>poly-type-list</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-type-reference&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-block'>
  <div class='production-number'>(47)</div>
  <div class='production-name'>comma-type-reference</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span></div>
<div class='section-description'>

      </div>
<h3>Expressions</h3>
<div class='production-block'>
  <div class='production-number'>(48)</div>
  <div class='production-name'>expression</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;literal&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>UNOP</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>BINOP</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>COLON</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='production-block'>
  <div class='production-number'>(49)</div>
  <div class='production-name'>literal</div>
  <div class='production-op'>::=</div>
<span class='production-token'>NUMBER</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>STRING</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>TRUE</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>FALSE</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;list-literal&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-literal&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(50)</div>
  <div class='production-name'>list-literal</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>OSB</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-expression&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CSB</span></div>
<div class='production-block'>
  <div class='production-number'>(51)</div>
  <div class='production-name'>comma-expression</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(52)</div>
  <div class='production-name'>object-literal</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OCB</span>&nbsp;<span class='production-token'>CCB</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>OCB</span>&nbsp;<span class='production-reference'>&lt;object-member&gt;</span>&nbsp;<span class='production-reference'>&lt;comma-object-member&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-token'>CCB</span></div>
<div class='production-block'>
  <div class='production-number'>(53)</div>
  <div class='production-name'>object-member</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;object-key&gt;</span>&nbsp;<span class='production-token'>COLON</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(54)</div>
  <div class='production-name'>object-key</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>STRING</span></div>
<div class='production-block'>
  <div class='production-number'>(55)</div>
  <div class='production-name'>comma-object-member</div>
  <div class='production-op'>::=</div>
<span class='production-token'>COMMA</span>&nbsp;<span class='production-reference'>&lt;object-member&gt;</span></div>
<div class='section-description'>

      We need to include . notation for fields, along with the fact that it has very high priority, so should probably be somewhere around the literal stage.
      But we don't particularly focus on operator precedence, so including it as a BINOP and noting that is probably fine.
      </div>
<h3>Handler</h3>
<div class='production-block'>
  <div class='production-number'>(56)</div>
  <div class='production-name'>handler-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLER</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-maybe-typed&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;implementation-method&gt;</span></div></div>
<div class='section-description'>

      </div>
<h3>Method</h3>
<div class='production-block'>
  <div class='production-number'>(57)</div>
  <div class='production-name'>standalone-method-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>METHOD</span>&nbsp;&nbsp;<span class='production-reference'>&lt;method-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(58)</div>
  <div class='production-name'>object-method-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>METHOD</span>&nbsp;&nbsp;<span class='production-reference'>&lt;method-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(59)</div>
  <div class='production-name'>method-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern&gt;</span><span class='production-many'>*</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;method-guards-or-actions&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(60)</div>
  <div class='production-name'>method-guards-or-actions</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;method-guards&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;method-actions&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(61)</div>
  <div class='production-name'>method-guards</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;method-guard&gt;</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(62)</div>
  <div class='production-name'>method-guard</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;method-action&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(63)</div>
  <div class='production-name'>method-actions</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;method-action&gt;</span><span class='production-many'>*</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;function-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(64)</div>
  <div class='production-name'>method-action</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;message-method-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;assign-method-action&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(65)</div>
  <div class='production-name'>message-method-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;service-method&gt;</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-reference'>&lt;maybe-handled&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(66)</div>
  <div class='production-name'>service-method</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>APPLY</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(67)</div>
  <div class='production-name'>maybe-handled</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLE</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='production-block'>
  <div class='production-number'>(68)</div>
  <div class='production-name'>assign-method-action</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;member-path&gt;</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(69)</div>
  <div class='production-name'>member-path</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;member-path-apply&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(70)</div>
  <div class='production-name'>member-path-apply</div>
  <div class='production-op'>::=</div>
<span class='production-token'>APPLY</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='section-description'>

      Note that standalone and object methods have the same syntax, but they are sufficiently different to make it worth making it clear
      In rule (65), the second case is supposed to represent the user creating either a single <tt>Action</tt> object or a list of them.
      Any other <tt>expression</tt> will end up being rejected at typecheck.
      Note that the first case of the rule is not, per se, a valid expression since the service object is not in scope, but actually it will parse as one.
      </div>
<h3>Object</h3>
<div class='production-block'>
  <div class='production-number'>(71)</div>
  <div class='production-name'>object-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>OBJECT</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;object-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(72)</div>
  <div class='production-name'>object-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;state-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-ctor-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;named-template-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-acor-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;object-method-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;function-case-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;handler-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(73)</div>
  <div class='production-name'>state-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>STATE</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;struct-field-decl&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(74)</div>
  <div class='production-name'>object-ctor-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CTOR</span>&nbsp;&nbsp;<span class='production-reference'>&lt;method-definition&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(75)</div>
  <div class='production-name'>object-acor-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ACOR</span>&nbsp;<span class='production-reference'>&lt;function-case-definition&gt;</span></div>
<div class='section-description'>

      </div>
<h3>Service</h3>
<div class='production-block'>
  <div class='production-number'>(76)</div>
  <div class='production-name'>service-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SERVICE</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;service-contents&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(77)</div>
  <div class='production-name'>service-contents</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;service-scope&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(78)</div>
  <div class='production-name'>service-scope</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;service-scope-unit&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(79)</div>
  <div class='production-name'>service-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;provides-contract&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;function-scope-unit&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(80)</div>
  <div class='production-name'>provides-contract</div>
  <div class='production-op'>::=</div>
<span class='production-token'>PROVIDES</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;implementation-method&gt;</span></div></div>
<div class='section-description'>

      </div>
<h3>Agent</h3>
<div class='production-block'>
  <div class='production-number'>(81)</div>
  <div class='production-name'>agent-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>AGENT</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;agent-contents&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(82)</div>
  <div class='production-name'>agent-contents</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;state-declaration&gt;</span>&nbsp;<span class='production-reference'>&lt;service-scope&gt;</span></div>
<div class='section-description'>

      </div>
<h3>Card</h3>
<div class='production-block'>
  <div class='production-number'>(83)</div>
  <div class='production-name'>card-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CARD</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;card-scope-unit&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(84)</div>
  <div class='production-name'>card-scope-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;state-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;named-template-definition&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;event-handler&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;requires-contract&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;implements-contract&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;service-scope-unit&gt;</span></div>
<div class='section-description'>

      </div>
<h3>Requires Contract</h3>
<div class='production-block'>
  <div class='production-number'>(85)</div>
  <div class='production-name'>requires-contract</div>
  <div class='production-op'>::=</div>
<span class='production-token'>REQUIRES</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<span class='production-token'>var-name</span></div>
<div class='section-description'>

        The requires block identifies a contract that this card needs to do its job.
        It requires a contract name and a variable.
        The variable can be used in the card to call the service bound to the contract.
      </div>
<h3>Implements Contract</h3>
<div class='production-block'>
  <div class='production-number'>(86)</div>
  <div class='production-name'>implements-contract</div>
  <div class='production-op'>::=</div>
<span class='production-token'>IMPLEMENTS</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;implementation-method&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(87)</div>
  <div class='production-name'>implementation-method</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-variable&gt;</span><span class='production-many'>*</span>&nbsp;<span class='production-reference'>&lt;implementation-result&gt;</span><span class='production-optional'>?</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;method-actions&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(88)</div>
  <div class='production-name'>implementation-result</div>
  <div class='production-op'>::=</div>
<span class='production-token'>HANDLE</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='section-description'>

      </div>
<h3>Events</h3>
<div class='production-block'>
  <div class='production-number'>(89)</div>
  <div class='production-name'>event-handler</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EVENT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;&nbsp;<span class='production-reference'>&lt;argument-pattern-typed&gt;</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;method-guards-or-actions&gt;</span></div></div>
<div class='section-description'>

        <p>An event handler is a special type of method on a card, which can respond to UI events.</p>
        <p>Although not part of the grammar, each event will receive an appropriate event object as its final argument.</p>
        <p>Event handlers are not called directly by the system but through the template mechanism (see some rule) and are generally curried, in that some arguments are presented as part of the configuration, and the event itself is provided by the system when called.</p>
        <p>Although it is not captured in this grammar, event handlers must have exactly one argument, which must be a TypedPattern and the type must be a member of the Event class hierarchy.</p>
      </div>
<h3>Templates</h3>
<div class='production-block'>
  <div class='production-number'>(90)</div>
  <div class='production-name'>named-template-definition</div>
  <div class='production-op'>::=</div>
<span class='production-token'>TEMPLATE</span>&nbsp;<span class='production-token'>template-name</span>&nbsp;<span class='production-reference'>&lt;define-template-chain&gt;</span><span class='production-optional'>?</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-bind&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(91)</div>
  <div class='production-name'>define-template-chain</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;template-chain-var&gt;</span><span class='production-many'>+</span></div>
<div class='production-block'>
  <div class='production-number'>(92)</div>
  <div class='production-name'>template-chain-var</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ORB</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>CRB</span></div>
<div class='section-description'>

        <p>Each card can have zero or more templates.  If it has no templates, it cannot have any visual representation.</p>
        <p>If it has at least one template, the first template name must be defined as a <tt>card</tt> in an associated webzip file.  Other templates must be associated with <tt>item</tt>s in a webzip file.</p>
        <p>Each template consists of a set of binding of values to portions of the template.</p>
        <p>Nested templates may have issues accessing their various state members.  Ideally, the nested chain of scoped variables should be inferred.
        However, in certain circumstances, this may not be possible; and in other circumstances shadowing or anonymity of variables may come into play.
        To solve these problmes, a template may specify variables that are in its enclosing chain.
        In all circumstances, the validity of the claims made here will be checked by the typechecker.
        The card's own template will <b>not</b> have any of these problems, and so cannot have this syntax.
        Item templates may have nesting chains but (top-level) card templates may not
        </p>
      </div>
<h3>Template Bindings</h3>
<div class='production-block'>
  <div class='production-number'>(93)</div>
  <div class='production-name'>template-bind</div>
  <div class='production-op'>::=</div>
<span class='production-token'>template-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;pass-to-template&gt;</span><span class='production-optional'>?</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>template-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;option-template-binds&gt;</span></div></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>template-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(94)</div>
  <div class='production-name'>option-template-binds</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;option-template-bind&gt;</span><span class='production-many'>+</span>&nbsp;<span class='production-reference'>&lt;default-option-template-bind&gt;</span><span class='production-optional'>?</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;default-option-template-bind&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(95)</div>
  <div class='production-name'>option-template-bind</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;pass-to-template&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(96)</div>
  <div class='production-name'>default-option-template-bind</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-reference'>&lt;pass-to-template&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(97)</div>
  <div class='production-name'>pass-to-template</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SENDTO</span>&nbsp;<span class='production-token'>template-name</span></div>
<div class='section-description'>

        <p>Each binding is responsible for filling one slot in the template, which can be of type <tt>punnet</tt>, <tt>container</tt> or <tt>content</tt>.</p>
        <p>The first case of rule (93) enables a value to be "assigned" to a slot in the template.  The exact semantics of this depend on the slot type; see <a href="index.html#connecting-elements-to-cards">connecting elements to cards</a> for details.</p>
        <p>The second case allows the assignment to be conditional on another expression.  In this case, the conditional (first) expression of each case of rule (95), which must be of type boolean, is considered and the first one to evaluate to <tt>true</tt> is selected.  The value (second) expression is then used as the value.  The rule (96) may be used to specify a default assignment if none of the previous cases match.</p>
        <p>The degenerate (third) case for rule (93) can only be used to customize <tt>style</tt> elements.  In this case the template name is provided and the styles and events are immediate descendants of this.</p>
        <p>For <tt>container</tt> slots <i>only</i>, it is possible to specify an <tt>item</tt> template that the value should be passed to using rule (97).</p>
        <p>Styling and event handling may be added to all elements except <tt>punnet</tt>s, which hand off styling and event handling to their contained cards.  In general, this will also not be used with <tt>container</tt> slots.</p>
      </div>
<h3>Template Customization</h3>
<div class='production-block'>
  <div class='production-number'>(98)</div>
  <div class='production-name'>template-customization</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;template-style&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;template-event&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(99)</div>
  <div class='production-name'>template-style</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-optional'>?</span>&nbsp;<span class='production-token'>SENDTO</span>&nbsp;<span class='production-token'>STRING</span><span class='production-many'>+</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;template-customization&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(100)</div>
  <div class='production-name'>template-event</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SENDTO</span>&nbsp;<span class='production-token'>var-name</span></div>
<div class='section-description'>

    			<p>For <tt>content</tt> and <tt>style</tt> elements, it is possible to <i>customize</i> the element by applying styling and adding event handlers.</p>
    			<p>Rule (99) defines the behaviour for styling.  Any number of styling rules may be applied; each will match the <tt>expr</tt> if supplied and, if not supplied or true, will add the classes identified by the strings to the element's class list.</p>
    			<p>Styles may then be furhter customized.</p>
    			<p>Rule (100) defines event handlers.  Each of the predefined events can be mapped exactly once per element.  The outcome will be the invocation of an event handler defined on the card as <tt>var-name</tt>.  It will receive a set of arguments along with an event object of a type appropriate for the named event.</p>
    		</div>
<h3>Unit Test Files</h3>
<div class='production-block'>
  <div class='production-number'>(101)</div>
  <div class='production-name'>unit-test-unit</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;unit-test-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-data-declaration&gt;</span></div>
<div class='section-description'>

        <p>Unit Tests are built into the FLAS language with special syntax.</p>
        <p>A unit test file in FLAS consists of a number of test and data declarations.</p>
        <p>The test declaration defines a unit test which should be run while the data declaration defines a name for a shared element of test data which can be used in multiple tests.</p>
      </div>
<h3>Unit Tests</h3>
<div class='production-block'>
  <div class='production-number'>(102)</div>
  <div class='production-name'>unit-test-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>TEST</span>&nbsp;<span class='production-token'>DOCWORD</span><span class='production-many'>+</span>&nbsp;&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;</span><span class='production-reference'>&lt;unit-test-step&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(103)</div>
  <div class='production-name'>unit-test-step</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;unit-data-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-event-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-invoke-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-contract-action&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-assert&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-shove&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-expect&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-test-match&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(104)</div>
  <div class='production-name'>unit-event-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EVENT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>template-name</span>&nbsp;<span class='production-token'>event-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(105)</div>
  <div class='production-name'>unit-invoke-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>INVOKE</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(106)</div>
  <div class='production-name'>unit-contract-action</div>
  <div class='production-op'>::=</div>
<span class='production-token'>CONTRACT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>type-name</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number'>(107)</div>
  <div class='production-name'>unit-test-assert</div>
  <div class='production-op'>::=</div>
<span class='production-token'>ASSERT</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;expression&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(108)</div>
  <div class='production-name'>unit-test-shove</div>
  <div class='production-op'>::=</div>
<span class='production-token'>SHOVE</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>APPLY</span>&nbsp;<span class='production-reference'>&lt;member-path&gt;</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;!</span><span class='production-reference'>&lt;expression&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(109)</div>
  <div class='production-name'>unit-test-expect</div>
  <div class='production-op'>::=</div>
<span class='production-token'>EXPECT</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span><span class='production-many'>*</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(110)</div>
  <div class='production-name'>unit-test-match</div>
  <div class='production-op'>::=</div>
<span class='production-token'>MATCH</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-reference'>&lt;unit-test-match-category&gt;</span></div>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(111)</div>
  <div class='production-name'>unit-test-match-category</div>
  <div class='production-op'>::=</div>
<span class='production-token'>TEXT</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-token'>STYLE</span></div>
<div class='section-description'>

        <p>Unit Tests are built into the FLAS language with special syntax.</p>
        <p>A unit test in FLAS is defined as being a test either:</p>
        <ul>
        <li>on the behaviour of a function or a standalone method;</li>
        <li>on the behaviour of a service, card or object method when receiving certain input;</li>
        <li>on the display of a card or object template in a given state;</li>
        <li>on the behaviour of a card event handler.</li>
        </ul>
        <p>In order to make all these cases easy, the unit test language allows values and messages to be easily defined and has special syntax for isolating and testing message outputs and template orchestration, independent of the actual template HTML provided.</p>
        <p>The <tt>assert</tt> action tests an expression and compares it to an expected value.  For convenience, this assertion allows the user to penetrate encapsulation and directly probe card or object state.</p>
        <p>The <tt>shove</tt> action allows a user to directly update card or object state for test purposes.  Note that this may allow the test to put the object in a state which cannot be reached by normal operations.  This is both a "bug" and a "feature".</p>
        <p>The <tt>event</tt> action simulates a UI input event and dispatches it to the card.  The first argument is a variable which is a reference to the card to receive the event.  The second is the name of an event handler. The expression will probably construct an event, but it could also be a reference to a data object.</p>
        <p>The <tt>invoke</tt> action invokes a method on an object.  This is just described as an "expression" but the semantics are that it must be a valid object method invocation.</p>
        <p>The <tt>contract</tt> action is supposed to invoke a method in a contract on a card.  The first argument is a data variable which is a reference to the card to receive the event.  The second argument is the name of the contract which will have the event.  The third var is the name of the method to invoke on the contract.  The expressions are the data elements to send.</p>
        <p>The <tt>expect</tt> action allows expectations to be defined.  This specifies a contract, a method and the arguments that are expected.</p>
        <p>Notes: Expectations should be available on invoke, event and contract. 
           In these expressions you should be able to specify an _ to say that you don't care what goes there or specify a function name which says that it is a matcher which takes one arg and returns a boolean.
           These functions should be nested within the expect block.
           If the pattern matches and true is returned, it's OK. If the patterns don't match and Error is returned, or the function explicitly returns false, the match fails.
           Obviously, we expect exactly all of the expectations to happen.
        </p>
        <p>We seem to have omitted tests on the HTML:

all based on the "match" command

text or styles (the ones specified by the program)
IT DOES NOT REFERENCE HTML
allow an optional selector - which is a path through the fields in the split HTML
allow the keyword "contains"
Subsequent indented lines are white-space approximation of the content or value
Examples:
match text
match html
match html contains
match html ... contains
match style ...
        
        </p>
      </div>
<h3>Unit Test Data</h3>
<div class='production-block'>
  <div class='production-number'>(112)</div>
  <div class='production-name'>unit-data-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-reference'>&lt;unit-expr-data-declaration&gt;</span></div>
<div class='production-or-block'>
  <div class='production-or'>|</div>
<span class='production-reference'>&lt;unit-fields-data-declaration&gt;</span></div>
<div class='production-block'>
  <div class='production-number'>(113)</div>
  <div class='production-name'>unit-expr-data-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>DATA</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span>&nbsp;<span class='production-token'>EOL</span></div>
<div class='production-block'>
  <div class='production-number'>(114)</div>
  <div class='production-name'>unit-fields-data-declaration</div>
  <div class='production-op'>::=</div>
<span class='production-token'>DATA</span>&nbsp;<span class='production-reference'>&lt;type-reference&gt;</span>&nbsp;<span class='production-token'>var-name</span>&nbsp;<div class='production-nested-block'><span class='production-nested'>&gt;&gt;&gt;</span><span class='production-reference'>&lt;unit-fields-data-initializer&gt;</span></div></div>
<div class='production-block'>
  <div class='production-number'>(115)</div>
  <div class='production-name'>unit-fields-data-initializer</div>
  <div class='production-op'>::=</div>
<span class='production-token'>var-name</span>&nbsp;<span class='production-token'>SEND</span>&nbsp;<span class='production-reference'>&lt;expression&gt;</span></div>
<div class='section-description'>

        <p>Declare a variable in test scope either as the result of a simple expression or by creating a compound object with field assignments.</p>
        <i>I feel the expression case possibly needs to be expanded to allow for object constructors to be invoked.</i>
      </div>
<h3>Protocol Tests</h3>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(116)</div>
  <div class='production-name'>protocol-test-unit</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span></div>
<div class='section-description'>

      <p>Much of what defines FLAS is the concept of the contract.</p>
      <p>There are many implementations of any given contract, but there should be certain characteristics common to all implementations of a contract.</p>
      <p>The purpose of protocol tests is to verify that for any given contract, all the implementations of the contract obey those invariants.</p>
      <p>Thus protocol tests are written in the context of a contract in a given direction, but then automatically applied to all implementations of that contract: objects, services and cards.</p>
      <i>informally, basically, I just want to say that if you do this sequence of things to a contract, it will respond appropriately.  It's more complex than that, but hopefully when I have some real examples, it will become clear.</i>
      </div>
<h3>System Tests</h3>
<div class='production-block'>
  <div class='production-number production-needs-testing'>(117)</div>
  <div class='production-name'>system-test-unit</div>
  <div class='production-op'>::=</div>
<span class='production-token'>GUARD</span></div>
<div class='section-description'>

      <p>System tests define end-to-end storyboard tests.</p>
      <p>They can come in two varieties: with or without a backend.</p>
      <p>In either case, the actions of both ends are actually defined in the test, it's just a question of where the service layer stops and is replaced by "mocks" implemented in the test.</p>
      <i>I haven't really thought this through, but I'm sure it will again become apparent when I want to write one.</i>
      </div>
</body>
</html>
